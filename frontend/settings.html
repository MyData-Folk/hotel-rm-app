<!doctype html>
<html lang="fr">
<head>
  <meta charset='utf-8'>
  <meta name='viewport' content='width=device-width,initial-scale=1'>
  <title>Settings - Hotel RM</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="p-6 bg-gray-50">
  <h1 class="text-2xl font-bold">Settings - Uploads</h1>

  <div class="mt-4 grid grid-cols-1 md:grid-cols-2 gap-4">
    <div class="bg-white p-4 rounded shadow">
      <h2 class="font-semibold">Uploader un fichier de données (Excel)</h2>
      <input type="file" id="excelFile" class="mt-2" accept=".xlsx" />
      <input id="hotelIdExcel" placeholder="hotel_id (default)" class="border px-2 py-1 rounded mt-2" />
      <button id="uploadExcelBtn" class="mt-2 px-3 py-2 bg-green-600 text-white rounded">Envoyer au backend</button>
    </div>
    <div class="bg-white p-4 rounded shadow">
      <h2 class="font-semibold">Uploader une config JSON</h2>
      <input type="file" id="jsonFile" class="mt-2" accept=".json" />
      <button id="uploadConfigBtn" class="mt-2 px-3 py-2 bg-indigo-600 text-white rounded">Importer config</button>
    </div>
  </div>

  <pre id="out" class="mt-6 bg-white p-4 rounded max-h-72 overflow-auto"></pre>

<script>
const API_URL = 'https://dgkw8ogg08w8c8w88o0wsg4w.72.60.91.16.sslip.io'; // ⚡ HTTPS obligatoire
const OUT = document.getElementById('out');

document.getElementById('uploadExcelBtn').addEventListener('click', async ()=>{
  OUT.textContent = 'Envoi en cours...';
  const f = document.getElementById('excelFile').files[0];
  const hid = document.getElementById('hotelIdExcel').value || 'default';
  if (!f) { OUT.textContent = 'Choisir un fichier .xlsx'; return; }
  const fd = new FormData(); fd.append('file', f);
  try {
    const res = await fetch(`${API_URL}/upload/excel?hotel_id=${encodeURIComponent(hid)}`, { method:'POST', body: fd });
    if (!res.ok) throw new Error(`Erreur serveur (${res.status})`);
    const json = await res.json();
    OUT.textContent = JSON.stringify(json, null, 2);
  } catch(e) {
    OUT.textContent = `❌ Erreur API: ${e.message}`;
  }
});

document.getElementById('uploadConfigBtn').addEventListener('click', async ()=>{
  OUT.textContent = 'Envoi en cours...';
  const f = document.getElementById('jsonFile').files[0];
  if (!f) { OUT.textContent = 'Choisir un fichier .json'; return; }
  const fd = new FormData(); fd.append('file', f);
  try {
    const res = await fetch(`${API_URL}/upload/config`, { method:'POST', body: fd });
    if (!res.ok) throw new Error(`Erreur serveur (${res.status})`);
    const json = await res.json();
    OUT.textContent = JSON.stringify(json, null, 2);
  } catch(e) {
    OUT.textContent = `❌ Erreur API: ${e.message}`;
  }
});
</script>
</body>
</html>
