<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title>Admin - Gestion des H√¥tels</title>
  <!-- Tailwind CDN safe version -->
  <script src="https://cdn.jsdelivr.net/npm/tailwindcss@3.4.3/dist/tailwind.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <style>
    body{font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica Neue,Arial}
    .scroll-slim::-webkit-scrollbar{height:8px;width:8px}
    .scroll-slim::-webkit-scrollbar-thumb{background:#223054;border-radius:999px}
  </style>
</head>
<body class="bg-gray-100 text-gray-800">

  <header class="bg-gray-900 text-white p-4 flex items-center justify-between">
    <h1 class="text-lg font-semibold">üè® Admin - H√¥tel Manager</h1>
    <button id="refreshHotels" class="px-3 py-1 bg-yellow-400 text-gray-900 rounded-md hover:bg-yellow-300">‚ü≥ Actualiser</button>
  </header>

  <main class="p-6 max-w-5xl mx-auto space-y-8">
    <!-- CREATE HOTEL -->
    <section class="bg-white rounded-lg shadow p-6 border border-gray-200">
      <h2 class="text-xl font-semibold mb-3">Cr√©er un H√¥tel</h2>
      <div class="flex flex-col sm:flex-row gap-3">
        <input id="hotelInput" class="flex-1 px-3 py-2 border border-gray-300 rounded-md" placeholder="Ex: folkestone">
        <button id="createHotelBtn" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">Cr√©er</button>
      </div>
    </section>

    <!-- HOTEL LIST -->
    <section class="bg-white rounded-lg shadow p-6 border border-gray-200">
      <h2 class="text-xl font-semibold mb-3">Liste des H√¥tels</h2>
      <ul id="hotelsList" class="divide-y divide-gray-200 text-sm"></ul>
    </section>

    <!-- UPLOAD -->
    <section class="bg-white rounded-lg shadow p-6 border border-gray-200">
      <h2 class="text-xl font-semibold mb-4">Importer des fichiers</h2>
      <div class="grid md:grid-cols-2 gap-6">
        <!-- Excel -->
        <div>
          <label class="block mb-2 text-sm font-medium text-gray-700">Excel (tarifs / r√©servations)</label>
          <input type="file" id="excelFile" accept=".xlsx,.csv" class="block w-full text-sm text-gray-600 border border-gray-300 rounded-md p-2">
          <button id="uploadExcel" class="mt-3 w-full bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700">Uploader Excel</button>
        </div>
        <!-- JSON -->
        <div>
          <label class="block mb-2 text-sm font-medium text-gray-700">Configuration JSON</label>
          <input type="file" id="jsonFile" accept=".json" class="block w-full text-sm text-gray-600 border border-gray-300 rounded-md p-2">
          <button id="uploadJson" class="mt-3 w-full bg-indigo-600 text-white px-4 py-2 rounded-md hover:bg-indigo-700">Uploader JSON</button>
        </div>
      </div>
    </section>
  </main>

  <div id="toast" class="fixed bottom-5 right-5 px-4 py-2 rounded-md text-white font-semibold hidden"></div>

  <script>
    const $ = s => document.querySelector(s);
    const LS = {
      get API(){ return localStorage.getItem('API_BASE') || defaultApi(); },
      set API(v){ localStorage.setItem('API_BASE', v); }
    };

    const defaultApi = () => {
      const host = window.location.host;
      if(host.startsWith('admin-')) return location.protocol + '//' + host.replace('admin-','api-');
      return location.origin;
    };

    function toast(msg, ok=true){
      const t = $('#toast');
      t.textContent = msg;
      t.className = `fixed bottom-5 right-5 px-4 py-2 rounded-md text-white font-semibold ${ok?'bg-green-600':'bg-red-600'}`;
      t.classList.remove('hidden');
      setTimeout(()=>t.classList.add('hidden'),3000);
    }

    async function loadHotels(){
      try {
        const r = await fetch(LS.API + '/hotels');
        const hotels = await r.json();
        const list = $('#hotelsList');
        if(!hotels.length){ list.innerHTML = `<li class="p-2 text-gray-500 italic">Aucun h√¥tel enregistr√©</li>`; return; }
        list.innerHTML = hotels.map(h=>`
          <li class="flex items-center justify-between py-2">
            <span>${h}</span>
            <button onclick="deleteHotel('${h}')" class="text-sm px-2 py-1 bg-red-600 text-white rounded-md hover:bg-red-700">Supprimer</button>
          </li>
        `).join('');
      } catch {
        toast('Erreur lors du chargement des h√¥tels', false);
      }
    }

    async function createHotel(){
      const id = $('#hotelInput').value.trim();
      if(!id){ toast('Nom d‚Äôh√¥tel requis', false); return; }
      try {
        const res = await fetch(LS.API + '/hotels', {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify({ hotel_id: id })
        });
        if(!res.ok) throw new Error();
        toast('H√¥tel ajout√© ‚úÖ');
        $('#hotelInput').value = '';
        loadHotels();
      } catch {
        toast('Erreur cr√©ation h√¥tel', false);
      }
    }

    async function deleteHotel(id){
      if(!confirm(`Supprimer ${id} ?`)) return;
      try {
        const res = await fetch(LS.API + '/hotels/' + encodeURIComponent(id), {method: 'DELETE'});
        if(!res.ok) throw new Error();
        toast('H√¥tel supprim√© üóëÔ∏è');
        loadHotels();
      } catch {
        toast('Erreur suppression', false);
      }
    }

    async function uploadFile(type){
      const fileInput = type==='excel'? $('#excelFile') : $('#jsonFile');
      const file = fileInput.files[0];
      if(!file){ toast('Choisissez un fichier', false); return; }

      const form = new FormData();
      form.append('file', file);

      try {
        const res = await fetch(`${LS.API}/upload?type=${type}`, {method:'POST', body:form});
        if(!res.ok) throw new Error();
        toast(`${type.toUpperCase()} envoy√© avec succ√®s ‚úÖ`);
        fileInput.value = '';
      } catch {
        toast(`Erreur upload ${type}`, false);
      }
    }

    $('#createHotelBtn').addEventListener('click', createHotel);
    $('#uploadExcel').addEventListener('click', ()=>uploadFile('excel'));
    $('#uploadJson').addEventListener('click', ()=>uploadFile('config'));
    $('#refreshHotels').addEventListener('click', loadHotels);

    document.addEventListener('DOMContentLoaded', loadHotels);
  </script>
</body>
</html>
